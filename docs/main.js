class J{canvas;ctx;currentScene=null;lastTime=0;accumulator=0;constructor(E){let M=document.getElementById(E);if(!M)throw Error(`Canvas element with id "${E}" not found`);this.canvas=M;let A=M.getContext("2d");if(!A)throw Error("Could not get 2D context");this.ctx=A}async setScene(E){this.currentScene=E,await E.create(this.ctx)}start(){this.lastTime=performance.now(),this.loop(this.lastTime)}loop=(E)=>{let M=E-this.lastTime;this.lastTime=E,this.accumulator+=M;while(this.accumulator>=33.333333333333336){if(this.currentScene)this.currentScene.update(this.ctx,33.333333333333336);this.accumulator-=33.333333333333336}requestAnimationFrame(this.loop)};getCanvas(){return this.canvas}getContext(){return this.ctx}}class K{grassImg=null;bushesImg=null;foxImg=null;dogImg=null;chickImg=null;chickBonesImg=null;titleImg=null;cluckSound=null;barkSound=null;introSound=null;lastBarkTime=0;scale=1;offsetX=0;offsetY=0;mapCanvas=null;mapCtx=null;wallMatrix=[];cameraX=0;cameraY=0;keys=new Set;player={x:0,y:0,width:0,height:0,frame:0};npcs=[];gameStarted=!1;gameOver=!1;levelComplete=!1;canvas=null;mouseTarget=null;isMouseDown=!1;score=0;highScore=0;level=1;lastAnimTime=0;async create(E){this.canvas=E.canvas,this.loadHighScore(),this.updateCanvasSize(),window.addEventListener("resize",()=>this.updateCanvasSize()),await this.loadAssets(),this.generateMaze(),this.initPlayer(),this.initNPCs(),this.renderMapToBuffer(),this.setupInput()}updateCanvasSize(){if(!this.canvas)return;this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight;let E=this.canvas.width/426,M=this.canvas.height/720;this.scale=Math.min(E,M),this.offsetX=(this.canvas.width-426*this.scale)/2,this.offsetY=(this.canvas.height-720*this.scale)/2}loadHighScore(){let E=document.cookie.match(/foxHighScore=(\d+)/);if(E)this.highScore=parseInt(E[1],10)}saveHighScore(){let E=new Date;E.setFullYear(E.getFullYear()+1),document.cookie=`foxHighScore=${this.highScore};expires=${E.toUTCString()};path=/`}setupInput(){document.addEventListener("touchstart",(M)=>{if(!this.gameStarted)this.startGame(),M.preventDefault()},{once:!0}),window.addEventListener("keydown",(M)=>{if(this.keys.add(M.key),M.key===" "){if(!this.gameStarted)this.startGame();else if(this.gameOver)this.restartGame();else if(this.levelComplete)this.nextLevel()}}),window.addEventListener("keyup",(M)=>{this.keys.delete(M.key)});let E=(M,A)=>{if(!this.canvas)return null;let S=this.canvas.getBoundingClientRect(),_=(M-S.left)*(this.canvas.width/S.width),F=(A-S.top)*(this.canvas.height/S.height),f=(_-this.offsetX)/this.scale,D=(F-this.offsetY)/this.scale;return{x:f+this.cameraX,y:D+this.cameraY}};this.canvas?.addEventListener("mousedown",(M)=>{if(!this.gameStarted){this.startGame();return}if(this.gameOver){this.restartGame();return}if(this.levelComplete){this.nextLevel();return}this.isMouseDown=!0,this.mouseTarget=E(M.clientX,M.clientY)}),this.canvas?.addEventListener("mousemove",(M)=>{if(this.isMouseDown&&!this.gameOver)this.mouseTarget=E(M.clientX,M.clientY)}),window.addEventListener("mouseup",()=>{this.isMouseDown=!1}),this.canvas?.addEventListener("touchstart",(M)=>{if(M.preventDefault(),!this.gameStarted){this.startGame();return}if(this.gameOver){this.restartGame();return}if(this.levelComplete){this.nextLevel();return}let A=M.touches[0];this.isMouseDown=!0,this.mouseTarget=E(A.clientX,A.clientY)}),this.canvas?.addEventListener("touchmove",(M)=>{if(this.isMouseDown&&!this.gameOver){M.preventDefault();let A=M.touches[0];this.mouseTarget=E(A.clientX,A.clientY)}}),window.addEventListener("touchend",()=>{this.isMouseDown=!1})}startGame(){if(this.gameStarted=!0,this.introSound)this.introSound.currentTime=0,this.introSound.play().catch(()=>{})}restartGame(){if(this.gameOver=!1,this.levelComplete=!1,this.score=0,this.level=1,this.npcs=[],this.generateMaze(),this.initPlayer(),this.initNPCs(),this.renderMapToBuffer(),this.introSound)this.introSound.pause(),this.introSound.currentTime=0}nextLevel(){this.levelComplete=!1,this.level++,this.npcs=[],this.generateMaze(),this.initPlayer(),this.initNPCs(),this.renderMapToBuffer()}getSpeedMultiplier(){return Math.pow(1.1,this.level-1)}async loadImage(E){let A=await(await fetch(E)).blob();return createImageBitmap(A,{premultiplyAlpha:"premultiply"})}async loadAssets(){[this.grassImg,this.bushesImg,this.foxImg,this.dogImg,this.chickImg,this.chickBonesImg,this.titleImg]=await Promise.all([this.loadImage("assets/plain_grass.png"),this.loadImage("assets/bushes.png"),this.loadImage("assets/fox-sprite.png"),this.loadImage("assets/dog-sprite.png"),this.loadImage("assets/chick-sprite.png"),this.loadImage("assets/chick-bones.png"),this.loadImage("assets/title.png")]),this.cluckSound=new Audio("assets/cluck.mp3"),this.cluckSound.preload="auto",this.cluckSound.load(),this.barkSound=new Audio("assets/bark.mp3"),this.barkSound.preload="auto",this.barkSound.load(),this.introSound=new Audio("assets/intro.mp3"),this.introSound.preload="auto",this.introSound.loop=!1,this.introSound.load()}playerOnLeft=!0;initPlayer(){if(!this.foxImg)return;this.player.width=120,this.player.height=120,this.player.frame=Math.floor(Math.random()*2),this.lastAnimTime=performance.now(),this.playerOnLeft=Math.random()<0.5;let E=Math.floor(3.6666666666666665),M,A;if(this.playerOnLeft)M=0,A=E;else M=11-E-1,A=10;for(let S=0;S<50;S++){let _=M+Math.floor(Math.random()*(A-M+1)),F=Math.floor(Math.random()*6);if(this.wallMatrix[F]?.[_])continue;this.player.x=_*120,this.player.y=F*120;return}this.player.x=0,this.player.y=0}initNPCs(){if(this.dogImg){let E=Math.floor(3.6666666666666665),M,A;if(this.playerOnLeft)M=11-E-1,A=10;else M=0,A=E;this.spawnNPC(this.dogImg,"dog",M,A)}if(this.chickImg){let E=4+Math.floor(Math.random()*2);for(let M=0;M<E;M++)this.spawnNPC(this.chickImg,"chick")}}spawnNPC(E,M,A=0,S=10){for(let _=0;_<50;_++){let F=A+Math.floor(Math.random()*(S-A+1)),f=Math.floor(Math.random()*6);if(f<0||f>=6||F<0||F>=11)continue;if(this.wallMatrix[f][F])continue;let D=F*120,B=f*120;if(this.hitboxesOverlap(D,B,this.player.x,this.player.y))continue;let G=!1;for(let q of this.npcs)if(this.hitboxesOverlap(D,B,q.x,q.y)){G=!0;break}if(G)continue;this.npcs.push({x:D,y:B,width:120,height:120,img:E,type:M,dead:!1,wanderTarget:{x:D,y:B},nextWanderTime:0,stuckTime:0,prevX:D,prevY:B,frame:Math.floor(Math.random()*2),lastAnimTime:performance.now()});break}}hitboxesOverlap(E,M,A,S){let _=E+20,F=M+20,f=A+20,D=S+20;return _<f+80&&_+80>f&&F<D+80&&F+80>D}rectsOverlap(E,M,A,S,_,F,f,D){return E<_+f&&E+A>_&&M<F+D&&M+S>F}generateMaze(){this.wallMatrix=[];for(let A=0;A<6;A++)this.wallMatrix.push(Array(11).fill(!1));this.placeIntersectingPair();let E=0,M=0;while(E<6&&M<200){if(this.placeDetachedWall())E++;M++}this.fixClosedBoxes()}fixClosedBoxes(){let E=[];for(let _=0;_<6;_++)E.push(Array(11).fill(!1));let M=-1,A=-1;for(let _=0;_<6&&M<0;_++)for(let F=0;F<11&&A<0;F++)if(!this.wallMatrix[_][F])M=_,A=F;if(M<0)return;let S=[{row:M,col:A}];while(S.length>0){let{row:_,col:F}=S.pop();if(_<0||_>=6||F<0||F>=11)continue;if(E[_][F]||this.wallMatrix[_][F])continue;E[_][F]=!0,S.push({row:_-1,col:F}),S.push({row:_+1,col:F}),S.push({row:_,col:F-1}),S.push({row:_,col:F+1})}for(let _=0;_<6;_++)for(let F=0;F<11;F++)if(!this.wallMatrix[_][F]&&!E[_][F]){this.breakOpenAt(_,F),this.fixClosedBoxes();return}}breakOpenAt(E,M){let A=[{dr:-1,dc:0},{dr:1,dc:0},{dr:0,dc:-1},{dr:0,dc:1}];for(let{dr:S,dc:_}of A){let F=E+S,f=M+_;if(F>=0&&F<6&&f>=0&&f<11){if(this.wallMatrix[F][f]){if(this.getWallSegmentLength(F,f)>2){this.wallMatrix[F][f]=!1;return}}}}for(let{dr:S,dc:_}of A){let F=E+S,f=M+_;if(F>=0&&F<6&&f>=0&&f<11){if(this.wallMatrix[F][f]){let D=this.getWallSegment(F,f);if(D&&this.canSlideWall(D,S,_)){this.slideWall(D,S,_);return}}}}for(let{dr:S,dc:_}of A){let F=E+S,f=M+_;if(F>=0&&F<6&&f>=0&&f<11){if(this.wallMatrix[F][f]){let D=this.getWallSegment(F,f);if(D){for(let B of D)this.wallMatrix[B.row][B.col]=!1;this.placeDetachedWall();return}}}}}getWallSegment(E,M){if(!this.wallMatrix[E][M])return null;let A=[{row:E,col:M}],S=M>0&&this.wallMatrix[E][M-1],_=M<10&&this.wallMatrix[E][M+1],F=E>0&&this.wallMatrix[E-1][M],f=E<5&&this.wallMatrix[E+1][M],D=S||_,B=F||f;if(D&&B)return null;if(D){for(let G=M-1;G>=0&&this.wallMatrix[E][G];G--)A.push({row:E,col:G});for(let G=M+1;G<11&&this.wallMatrix[E][G];G++)A.push({row:E,col:G})}else if(B){for(let G=E-1;G>=0&&this.wallMatrix[G][M];G--)A.push({row:G,col:M});for(let G=E+1;G<6&&this.wallMatrix[G][M];G++)A.push({row:G,col:M})}return A}canSlideWall(E,M,A){for(let S of E){let _=S.row+M,F=S.col+A;if(_<0||_>=6||F<0||F>=11)return!1;let f=[{r:_-1,c:F},{r:_+1,c:F},{r:_,c:F-1},{r:_,c:F+1}];for(let D of f)if(D.r>=0&&D.r<6&&D.c>=0&&D.c<11){if(this.wallMatrix[D.r][D.c]){if(!E.some((G)=>G.row===D.r&&G.col===D.c))return!1}}}return!0}slideWall(E,M,A){for(let S of E)this.wallMatrix[S.row][S.col]=!1;for(let S of E){let _=S.row+M,F=S.col+A;this.wallMatrix[_][F]=!0}}getWallSegmentLength(E,M){if(!this.wallMatrix[E][M])return 0;let A=M>0&&this.wallMatrix[E][M-1]||M<10&&this.wallMatrix[E][M+1],S=E>0&&this.wallMatrix[E-1][M]||E<5&&this.wallMatrix[E+1][M],_=1;if(A&&!S){for(let F=M-1;F>=0&&this.wallMatrix[E][F];F--)_++;for(let F=M+1;F<11&&this.wallMatrix[E][F];F++)_++}else if(S&&!A){for(let F=E-1;F>=0&&this.wallMatrix[F][M];F--)_++;for(let F=E+1;F<6&&this.wallMatrix[F][M];F++)_++}else _=Math.max(_,2);return _}placeIntersectingPair(){for(let F=2;F<5;F++)this.wallMatrix[2][F]=!0;let _=3;for(let F=1;F<=3;F++)this.wallMatrix[F][_]=!0}placeDetachedWall(){let E=Math.random()<0.5,M=2+Math.floor(Math.random()*4),A,S,_=[];if(E){let F=10-M;if(F<1)return!1;A=1+Math.floor(Math.random()*F),S=1+Math.floor(Math.random()*4);for(let f=A;f<A+M;f++)_.push({row:S,col:f})}else{let F=5-M;if(F<1)return!1;S=1+Math.floor(Math.random()*F),A=1+Math.floor(Math.random()*9);for(let f=S;f<S+M;f++)_.push({row:f,col:A})}for(let F of _)if(this.touchesAnyWall(F.row,F.col))return!1;for(let F of _)this.wallMatrix[F.row][F.col]=!0;return!0}touchesAnyWall(E,M){if(this.wallMatrix[E][M])return!0;if(E>0&&this.wallMatrix[E-1][M])return!0;if(E<5&&this.wallMatrix[E+1][M])return!0;if(M>0&&this.wallMatrix[E][M-1])return!0;if(M<10&&this.wallMatrix[E][M+1])return!0;return!1}isWall(E,M){if(E<0||E>=6||M<0||M>=11)return!1;return this.wallMatrix[E][M]}getTileIndex(E,M){let A=this.isWall(E-1,M),S=this.isWall(E+1,M),_=this.isWall(E,M-1),F=this.isWall(E,M+1),f=A||S,D=_||F;if(f&&D)return 4;if(f)if(A&&S)return 0;else if(S)return 1;else return 6;if(D)if(_&&F)return 2;else if(F)return 3;else return 5;return 4}renderMapToBuffer(){if(this.mapCanvas=new OffscreenCanvas(1320,720),this.mapCtx=this.mapCanvas.getContext("2d"),this.grassImg){let E=this.grassImg.width,M=this.grassImg.height;for(let A=0;A<720;A+=M)for(let S=0;S<1320;S+=E)this.mapCtx.drawImage(this.grassImg,S,A)}}update(E,M){if(E.fillStyle="#000000",E.fillRect(0,0,E.canvas.width,E.canvas.height),this.grassImg){E.globalAlpha=0.3;let G=this.grassImg.width,q=this.grassImg.height;for(let I=0;I<E.canvas.height;I+=q)for(let T=0;T<E.canvas.width;T+=G)E.drawImage(this.grassImg,T,I);E.globalAlpha=1}if(E.save(),E.translate(this.offsetX,this.offsetY),E.scale(this.scale,this.scale),E.beginPath(),E.rect(0,0,426,720),E.clip(),!this.gameStarted){if(this.grassImg){let G=this.grassImg.width,q=this.grassImg.height;for(let I=0;I<720;I+=q)for(let T=0;T<426;T+=G)E.drawImage(this.grassImg,T,I,G+1,q+1)}if(this.titleImg)E.drawImage(this.titleImg,0,0,426,720);E.restore();return}if(!this.mapCanvas){E.restore();return}let A=performance.now(),S=250;if(A-this.lastAnimTime>=S)this.player.frame=(this.player.frame+1)%2,this.lastAnimTime=A;let _=250;for(let G of this.npcs)if(!G.dead&&A-G.lastAnimTime>=_)G.frame=(G.frame+1)%2,G.lastAnimTime=A;if(!this.gameOver&&!this.levelComplete){let G=this.player.x,q=this.player.y;if(this.keys.has("ArrowLeft"))G-=8;if(this.keys.has("ArrowRight"))G+=8;if(this.keys.has("ArrowUp"))q-=8;if(this.keys.has("ArrowDown"))q+=8;if(this.mouseTarget&&this.isMouseDown){let I=this.mouseTarget.x-(this.player.x+this.player.width/2),T=this.mouseTarget.y-(this.player.y+this.player.height/2),$=Math.sqrt(I*I+T*T);if($>10)G=this.player.x+I/$*8,q=this.player.y+T/$*8}if(!this.collidesWithWall(G,this.player.y))this.player.x=G;if(!this.collidesWithWall(this.player.x,q))this.player.y=q;this.player.x=Math.max(0,Math.min(this.player.x,1320-this.player.width)),this.player.y=Math.max(0,Math.min(this.player.y,720-this.player.height)),this.updateNPCs(performance.now()),this.checkChickCollisions(),this.checkDogCollision()}this.cameraX=this.player.x+this.player.width/2-213,this.cameraY=this.player.y+this.player.height/2-360,this.cameraX=Math.max(0,Math.min(this.cameraX,894)),this.cameraY=Math.max(0,Math.min(this.cameraY,0)),E.clearRect(0,0,426,720),E.drawImage(this.mapCanvas,this.cameraX,this.cameraY,426,720,0,0,426,720),E.globalCompositeOperation="source-over",E.font="bold 24px sans-serif",E.textAlign="left",E.textBaseline="top";let F="Score: ",f=`${this.score}`,D=12+E.measureText(F).width;E.shadowColor="rgba(0, 0, 0, 1)",E.shadowBlur=8,E.shadowOffsetX=0,E.shadowOffsetY=0,E.fillStyle="#ff5555",E.fillText(F,12,40),E.fillStyle="#ffffff",E.fillText(f,D,40),E.font="14px sans-serif",E.fillStyle="#ffffff",E.fillText(`High Score: ${this.highScore}`,12,68),E.shadowColor="transparent",E.shadowBlur=0;let B=[];if(this.bushesImg){for(let G=0;G<6;G++)for(let q=0;q<11;q++)if(this.wallMatrix[G][q]){let I=this.getTileIndex(G,q);B.push({type:"bush",img:this.bushesImg,x:q*120,y:G*120,tileIndex:I})}}if(this.foxImg)B.push({type:"player",img:this.foxImg,x:this.player.x,y:this.player.y});for(let G of this.npcs)if(G.dead)B.push({type:"bone",img:G.img,x:G.x,y:G.y});else B.push({type:"npc",img:G.img,x:G.x,y:G.y,frame:G.frame});B.sort((G,q)=>G.y-q.y);for(let G of B){let q=G.x-this.cameraX,I=G.y-this.cameraY;if(G.type==="bush"&&G.tileIndex!==void 0)E.drawImage(G.img,G.tileIndex*120,0,120,120,q,I,120,120);else if(G.type==="player")E.fillStyle="rgba(0, 0, 0, 0.25)",E.beginPath(),E.ellipse(q+60,I+120-10,22,8,0,0,Math.PI*2),E.fill(),E.drawImage(G.img,this.player.frame*120,0,120,120,q,I,120,120);else if(G.type==="npc"&&G.frame!==void 0)E.fillStyle="rgba(0, 0, 0, 0.25)",E.beginPath(),E.ellipse(q+60,I+120-15,22,8,0,0,Math.PI*2),E.fill(),E.drawImage(G.img,G.frame*120,0,120,120,q,I,120,120);else if(G.type==="bone")E.fillStyle="rgba(0, 0, 0, 0.25)",E.beginPath(),E.ellipse(q+60,I+120-24,55,10,0,0,Math.PI*2),E.fill(),E.drawImage(G.img,q,I,120,120);else E.drawImage(G.img,q,I,120,120)}if(this.gameOver)E.fillStyle="rgba(0, 0, 0, 0.6)",E.fillRect(0,0,426,720),E.fillStyle="#ff5555",E.font="bold 48px sans-serif",E.textAlign="center",E.textBaseline="middle",E.fillText("Game Over",213,330),E.fillStyle="#ffffff",E.font="24px sans-serif",E.fillText("Tap to Retry",213,390);if(this.levelComplete)E.fillStyle="rgba(0, 0, 0, 0.6)",E.fillRect(0,0,426,720),E.fillStyle="#55ff55",E.font="bold 48px sans-serif",E.textAlign="center",E.textBaseline="middle",E.fillText("Level Complete",213,330),E.fillStyle="#ffffff",E.font="24px sans-serif",E.fillText("Tap to Continue",213,390);E.restore()}collidesWithWall(E,M){let A=E+20,S=M+20,_=Math.floor(A/120),F=Math.floor((A+80-1)/120),f=Math.floor(S/120),D=Math.floor((S+80-1)/120);for(let B=f;B<=D;B++)for(let G=_;G<=F;G++)if(this.wallMatrix[B]?.[G]){let q=G*120+20,I=B*120+20;if(A<q+80&&A+80>q&&S<I+80&&S+80>I)return!0}for(let B of this.npcs)if(!B.dead&&B.type!=="chick"&&this.hitboxesOverlap(E,M,B.x,B.y))return!0;return!1}checkChickCollisions(){for(let E of this.npcs)if(E.type==="chick"&&!E.dead){if(this.hitboxesOverlap(this.player.x,this.player.y,E.x,E.y)){if(E.dead=!0,this.score++,this.score>this.highScore)this.highScore=this.score,this.saveHighScore();if(this.chickBonesImg)E.img=this.chickBonesImg;if(this.cluckSound)this.cluckSound.currentTime=0,this.cluckSound.play();if(this.npcs.filter((A)=>A.type==="chick"&&!A.dead).length===0)this.levelComplete=!0}}}checkDogCollision(){for(let E of this.npcs)if(E.type==="dog"&&!E.dead){if(this.hitboxesOverlap(this.player.x,this.player.y,E.x,E.y)){if(this.gameOver=!0,this.introSound)this.introSound.currentTime=0,this.introSound.play();return}}}updateNPCs(E){let M=this.getSpeedMultiplier();for(let A of this.npcs){if(A.dead)continue;let S=this.hasLineOfSight(A.x,A.y,this.player.x,this.player.y),_=this.player.x-A.x,F=this.player.y-A.y,f=Math.sqrt(_*_+F*F);if(A.type==="chick")if(S)this.moveNpcAway(A,this.player.x,this.player.y,5*M);else this.wanderNpc(A,E,2*M);else if(A.type==="dog")if(S&&f<300){if(this.moveNpcToward(A,this.player.x,this.player.y,5*M),this.barkSound&&E-this.lastBarkTime>=4000)this.barkSound.currentTime=0,this.barkSound.play(),this.lastBarkTime=E}else this.wanderNpc(A,E,3*M);if(A.x=Math.max(0,Math.min(A.x,1320-A.width)),A.y=Math.max(0,Math.min(A.y,720-A.height)),Math.abs(A.x-A.prevX)+Math.abs(A.y-A.prevY)<0.5)A.stuckTime++;else A.stuckTime=0;A.prevX=A.x,A.prevY=A.y}}wanderNpc(E,M,A){let S=E.wanderTarget.x-E.x,_=E.wanderTarget.y-E.y;if(Math.sqrt(S*S+_*_)<20||M>E.nextWanderTime||E.stuckTime>15)this.pickRandomWanderTarget(E),E.nextWanderTime=M+1000+Math.random()*1000,E.stuckTime=0;this.moveNpcToward(E,E.wanderTarget.x,E.wanderTarget.y,A)}pickRandomWanderTarget(E){for(let M=0;M<20;M++){let A=Math.floor(Math.random()*11),S=Math.floor(Math.random()*6);if(S>=0&&S<6&&A>=0&&A<11){if(!this.wallMatrix[S][A]){E.wanderTarget.x=A*120,E.wanderTarget.y=S*120;return}}}}moveNpcToward(E,M,A,S){let _=M-E.x,F=A-E.y,f=Math.sqrt(_*_+F*F);if(f<1)return;let D=_/f*S,B=F/f*S,G=E.x+D,q=E.y+B;if(!this.npcCollidesWithWall(E,G,E.y))E.x=G;if(!this.npcCollidesWithWall(E,E.x,q))E.y=q}moveNpcAway(E,M,A,S){let _=E.x-M,F=E.y-A,f=Math.sqrt(_*_+F*F);if(f<1)return;let D=_/f*S,B=F/f*S,G=20,q=!1;if(E.x<=G&&D<0)D=0,q=!0;if(E.x>=1320-E.width-G&&D>0)D=0,q=!0;if(E.y<=G&&B<0)B=0,q=!0;if(E.y>=720-E.height-G&&B>0)B=0,q=!0;if(q||E.stuckTime>5){let $=S*0.8;D+=(Math.random()-0.5)*$*2,B+=(Math.random()-0.5)*$*2}let I=E.x+D,T=E.y+B;if(!this.npcCollidesWithWall(E,I,E.y))E.x=I;if(!this.npcCollidesWithWall(E,E.x,T))E.y=T}npcCollidesWithWall(E,M,A){let S=M+20,_=A+20,F=Math.floor(S/120),f=Math.floor((S+80-1)/120),D=Math.floor(_/120),B=Math.floor((_+80-1)/120);for(let G=D;G<=B;G++)for(let q=F;q<=f;q++)if(this.wallMatrix[G]?.[q]){let I=q*120+20,T=G*120+20;if(S<I+80&&S+80>I&&_<T+80&&_+80>T)return!0}return!1}hasLineOfSight(E,M,A,S){let _=E+60,F=M+60,f=A+60,D=S+60,B=f-_,G=D-F,q=Math.sqrt(B*B+G*G),I=Math.max(1,Math.floor(q/20));for(let T=0;T<=I;T++){let $=T/I,Q=_+B*$,Z=F+G*$,U=Math.floor(Q/120),j=Math.floor(Z/120);if(this.wallMatrix[j]?.[U])return!1}return!0}}var L=new J("game");await L.setScene(new K);L.start();
